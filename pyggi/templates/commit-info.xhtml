{% extends "pyggi/base.xhtml" %}

{% block content %}

{% include "pyggi/repo.xhtml" %}
{% include "pyggi/commit.xhtml" %}

{% set repo = repository.name %}
{% set commit = repository.commit(treeid) %}
{% set diffs = commit.diffs %}

<div class="breadcrumbs">
	Commit <code>{{ treeid|truncate(20, true, '') }}</code>
</div>

Showing {{ commit.stats.total['files'] }} changed files with {{ commit.stats.total['insertions'] }} additions and {{ commit.stats.total['deletions'] }} deletions.

<style type="text/css" media="screen">
	.meta {
		background: #EEE url("{{ url_for('static', filename='images/bg_file.gif') }}") repeat-x 0px 0px;
	}

	#diff-toc .stat-icon {
		background-image: url("{{ url_for('static', filename='images/file_modes.png') }}");
	}
</style>

<table cellspacing="0" cellpadding="0" id="diff-toc">
{% for diff in diffs %}
	<tr>
		<td class="status">
			{% if diff.new_file %}<span class="stat-icon added" title="added">A</span>
			{% elif diff.deleted_file %}<span class="stat-icon removed" title="removed">D</span>
			{% elif diff.rename_from %}<span class="stat-icon renamed" title="renamed">R</span>
			{% else %}<span class="stat-icon modified" title="modified">M</span>{% endif %}
		</td>
		<td>
			{% if diff.rename_from %}
			<a href="#diff-{{ loop.index }}">{{ diff.rename_from }} &rarr; {{ diff.rename_to }}</a>
			{% else %}
			<a href="#diff-{{ loop.index }}">{{ diff.b_path }}</a>
			{% endif %}
		</td>
		<td class="diffstat">
			<div class="stats">{{ commit.stats.files[diff.b_path]['insertions'] }} insertions &amp; {{ commit.stats.files[diff.b_path]['deletions'] }} deletions</div>
		</td>
	</tr>
{% endfor %}
</table>


{% for diff in diffs %}
<div id="diff-{{ loop.index }}" class="diff-container">

<div class="meta">
	<div class="info">
		<span class="icon"><img alt="file" src="{{ url_for('static', filename='images/txt.png') }}" width="16" height="16" /></span>
		{% if diff.rename_from %}
			<span>{{ diff.rename_from }} &rarr; {{ diff.rename_to }}</span>
		{% else %}
			<span>{{ diff.b_path }}</span>
		{% endif %}
	</div>
	<ul class="actions">
		<li><a href="{{ url_for('blob', repository=repo, tree=treeid, path=diff.b_path) }}"><b>View file @</b> {{ treeid|truncate(8, true, '') }}</a></li>
	</ul>
</div>

<div class="diff-code">
{% if diff.rename_from %}
<div class="diff-note">File renamed without changes</div>
{% elif diff.diff.startswith("Binary") %}
<div class="diff-note">Binary file not shown</div>
{% else %}
	{% for line in diff.diff.split("\n")[2:] %}
		{{ line|diffformat|safe }}
	{% endfor %}
{% endif %}
</div>

</div>
{% endfor %}

{% endblock %}
