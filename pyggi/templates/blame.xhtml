{% extends "pyggi/base.xhtml" %}

{% block content %}

{% include "pyggi/repo.xhtml" %}
{% include "pyggi/commit.xhtml" %}
{% include "pyggi/breadcrumbs.xhtml" %}

{% set path = '/'.join(breadcrumbs) %}
{% set repo = repository.name %}
{% set file = '/'.join([treeid,path]) %}
{% set blob = repository.blob(file) %}
{% set blame = repository.blame(file) %}

<style type="text/css" media="screen">
	#blame .meta {
		background: #EEE url("{{ url_for('static', filename='images/bg_file.gif') }}") repeat-x 0px 0px;
	}
</style>

<div id="blame">
	<div class="meta">
		<div class="info">
			<span class="icon"><img alt="file" src="{{ url_for('static', filename='images/txt.png') }}" width="16" height="16" /></span>
			<span class="mode">{{ blob.mode }} |</span>
			<span>{{ blob.mime_type }} |</span>
			<span>{{ blob.size|sizeformat }}</span>
		</div>
		<ul class="actions">
			<li><a href="{{ url_for('raw', repository=repo, tree=treeid, path=path) }}">raw</a>&nbsp;&nbsp;| </li>
			<li><a href="{{ url_for('blob', repository=repo, tree=treeid, path=path) }}">normal</a>&nbsp;&nbsp;| </li>
			<li><a href="{{ url_for('history', repository=repo, tree=treeid, path=path) }}">history</a></li>
		</ul>
	</div>


<div class="data">
{% if blob.mime_type.startswith("text/") %}
<table cellspacing="0" cellpadding="0">
{% set lcounter = 0 %}
{% for blameinfo in blame %}
	{% if blameinfo[0] %}
	<tr>
		<td nowrap class="commitinfo first">
			<code>
				<a href="{{ url_for('commit', repository=repo, tree=blameinfo[0].id) }}">{{ blameinfo[0].id|truncate(8, true, '') }}</a>
				<a href="{{ url_for('blame', repository=repo, tree=blameinfo[0].id, path=path) }}">&#187;</a>
				{{ blameinfo[0].author.name }}
			</code>
			<br />
			<span class="date">{{ blameinfo[0].committed_date|dateformat("%Y-%m-%d") }}</span>
			<span class="message">{{ blameinfo[0].message|truncate(35, true) }}</span>
		</td>
		<td nowrap class="linenumber first">{{ lcounter + 1 }}</td>
		<td nowrap class="code first" width="100%">{{ blameinfo[1][0] }}
	</tr>
	{% for blameline in blameinfo[1][1:] %}
	<tr>
		<td nowrap class="commitinfo">&nbsp;</td>
		<td nowrap class="linenumber">{{ lcounter + loop.index + 1 }}</td>
		<td nowrap class="code">{{ blameline }}</td>
	</tr>
	{% endfor %}
	{% set lcounter = lcounter + blameinfo[1]|length %}
	{% endif %}
{% endfor %}
</table>
{% else %}
<div class="note">no blame data for binary data</div>
{% endif %}
</div>

</div>
{% endblock %}
