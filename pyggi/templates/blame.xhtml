{% extends "base.xhtml" %}

{% block content %}

{% set path = '/'.join(breadcrumbs) %}
{% set repo = repository.name %}
{% set file = '/'.join([treeid,path]) %}
{% set blob = repository.blob(file) %}
{% set blame = repository.blame(file) %}

<!-- MENU -->
<div class="menu">
    <h1>info</h1>
    <ul>
        <li>{{ blob.mime_type }}</li>
        <li>{{ blob.size|filesizeformat }}</li>
    </ul>
    <h1>actions</h1>
    <ul>
        <li><a href="{{ url_for('.blob', repository=repo, tree=treeid, path=path) }}">overview</a></li>
        <li><a href="{{ url_for('.blame', repository=repo, tree=treeid, path=path ) }}">blame</a></li>
        <li><a href="{{ url_for('.raw', repository=repo, tree=treeid, path=path) }}">raw</a></li>
    </ul>
</div>

<div class="content" style="margin-left: 150px;">
	<h1>blame for {{ path }}</h1>
{% if blob.mime_type is text %}
<table cellspacing="0" cellpadding="0">
{% set lcounter = 0 %}
{% for blameinfo in blame %}
	{% if blameinfo[0] %}
	<tr>
		<td nowrap class="commitinfo first">
			<code>
				<a href="{{ url_for('.commit', repository=repo, tree=blameinfo[0].id) }}">{{ blameinfo[0].id|truncate(8, true, '') }}</a>
				<a href="{{ url_for('.blame', repository=repo, tree=blameinfo[0].id, path=path) }}">&#187;</a>
				{{ blameinfo[0].author.name }}
			</code>
		</td>
		<td nowrap class="linenumber first">{{ lcounter + 1 }}</td>
		<td nowrap class="code first" width="100%">{{ blameinfo[1][0] }}
	</tr>
	{% for blameline in blameinfo[1][1:] %}
	<tr>
		<td nowrap class="commitinfo">&nbsp;</td>
		<td nowrap class="linenumber">{{ lcounter + loop.index + 1 }}</td>
		<td nowrap class="code">{{ blameline }}</td>
	</tr>
	{% endfor %}
	{% set lcounter = lcounter + blameinfo[1]|length %}
	{% endif %}
{% endfor %}
</table>
{% endif %}
</div>

<div style="clear: both;">&nbsp;</div>

{% endblock %}
