{% extends "pyggi/base.xhtml" %}

{% block content %}

{% include "pyggi/breadcrumbs.xhtml" %}

{% if breadcrumbs %}
	{% set tree = repository.tree('/'.join([treeid]+breadcrumbs)).values %}
{% else %}
	{% set tree = repository.tree(treeid).values %}
{% endif %}
{% set repo = repository.name %}
{% set readme = repository.readme %}

<table class="tree-browser" cellpadding="0" cellspacing="0">
	<tbody>
		<tr>
			<th class="icon">&nbsp;</th>
			<th>name</th>
			<th>last modified</th>
			<th>message</th>
		</tr>
{% if breadcrumbs %}
	<tr>
		<td class="icon">&nbsp;</td>
		<td class="content">
			{% set path='/'.join(breadcrumbs[:-1]) %}
			{% if path %}
			<a href="{{ url_for('browse_sub', repository=repo, tree=treeid, path='/'.join(breadcrumbs[:-1])) }}">..</a>
			{% else %}
			<a href="{{ url_for('browse', repository=repo, tree=treeid) }}">..</a>
			{% endif %}
		</td>
		<td class="age">&nbsp;</td>
		<td class="message">&nbsp;</td>
	</tr>
{% else %}
{% set breadcrumbs=[] %}
{% endif %}

{% for item in repository.submodules('/'.join(breadcrumbs), treeid) %}
	<tr>
		<td class="icon">
			<img alt="link" src="{{ url_for('static', filename='images/link.png') }}" width="16" height="16" />
		</td>
		<td class="content">
			{{ item.path_name }} &rarr; {{ item.url }}
		</td>
		<td class="age">&nsbp;</td>
		<td class="message">&nbsp;</td>
	</tr>
{% endfor %}

{% for item in tree %}
	<tr>
		<td class="icon">
			{% if item.is_tree %}
			<img alt="directory" src="{{ url_for('static', filename='images/dir.png') }}" width="16" height="16" />
			{% else %}
			<img alt="file" src="{{ url_for('static', filename='images/txt.png') }}" width="16" height="16" />
			{% endif %}
		</td>
		<td class="content">
			{% if item.is_tree %}
			<a href="{{ url_for('browse_sub', repository=repo, tree=treeid, path='/'.join(breadcrumbs+[item.name])) }}">
			{% else %}
			<a href="{{ url_for('blob', repository=repo, tree=treeid, path='/'.join(breadcrumbs+[item.name])) }}">
			{% endif %}
				{{ item.name }}{% if item.is_tree %}/{% endif %}
			</a>
		</td>
		<td class="age">
			{{ item.last_commit.committed_date|dateformat }}
		</td>
		<td class="message">
			{{ item.last_commit.message|truncate(70) }}
		</td>
	</tr>
{% endfor %}
	</tbody>
</table>

{% endblock %}
